================================================================================
                    INCEPTION - BONUS SERVICES TESTING GUIDE
================================================================================

This guide shows step-by-step how to test ALL bonus services.
Run these commands in order to verify everything works.

================================================================================
PREREQUISITES
================================================================================

1. Make sure all containers are running:
   docker ps

   Should show: nginx, wordpress, mariadb, redis, ftp, adminer, website, portainer

2. Check all services are up:
   docker compose -f srcs/docker-compose.yaml ps


================================================================================
1. REDIS CACHE TESTING üßä
================================================================================

Purpose: Speed up WordPress by caching database queries

--- Step 1: Check Redis container is running ---
docker ps | grep redis

Expected: redis container UP

--- Step 2: Test Redis responds ---
docker exec redis redis-cli ping

Expected: PONG

--- Step 3: Check if Redis has cached data ---
docker exec redis redis-cli DBSIZE

Expected: 
  - 0 = Redis not integrated yet (need to rebuild WordPress with php-redis)
  - >0 = Redis is working and caching data!

--- Step 4: Check what's cached ---
docker exec redis redis-cli KEYS '*'

Expected: wp:* keys if WordPress Redis plugin is active

--- Step 5: Monitor Redis in real-time ---
docker exec redis redis-cli MONITOR

Then open https://hheng.42.fr in browser
You should see GET/SET commands scrolling by!
Press Ctrl+C to stop monitoring

--- Step 6: Test cache performance ---

# Clear Redis cache
docker exec redis redis-cli FLUSHALL

# Visit WordPress (slow - no cache)
time curl -k -s https://hheng.42.fr > /dev/null

# Visit again (fast - cached!)
time curl -k -s https://hheng.42.fr > /dev/null

Expected: Second request should be faster!

--- Verify WordPress Redis Integration ---
docker exec wordpress php -m | grep redis

Expected: "redis" in the output


================================================================================
2. ADMINER (DATABASE MANAGER) TESTING üóÑÔ∏è
================================================================================

Purpose: Web-based database administration tool

--- Step 1: Check Adminer is running ---
docker ps | grep adminer

Expected: adminer container UP on port 8080

--- Step 2: Test Adminer web access ---
curl -s http://localhost:8080 | grep -i adminer

Expected: HTML with "Adminer" text

--- Step 3: Open in Browser ---
Open: http://localhost:8080

--- Step 4: Login to Adminer ---
System:   MySQL
Server:   mariadb
Username: wpuser (or check your .env: cat srcs/.env | grep MYSQL_USER)
Password: (get from: cat secrets/db_password.txt)
Database: wordpress

Click "Login"

--- Step 5: Verify Database Tables ---
After login, you should see tables:
  - wp_posts
  - wp_users
  - wp_comments
  - wp_options
  - etc.

--- Step 6: Test SQL Query ---
Click "SQL command" and run:

SELECT user_login, user_email FROM wp_users;

Expected Result:
  user_login | user_email
  -----------+------------------
  hheng      | admin@hheng.42.fr
  wpuser2    | user@hheng.42.fr

--- Step 7: View WordPress Posts ---
Click on "wp_posts" table
Click "Select data"

Expected: See all your WordPress posts


================================================================================
3. FTP (FILE UPLOAD) TESTING üìÅ
================================================================================

Purpose: Upload/download WordPress files via FTP

--- Step 1: Check FTP is running ---
docker ps | grep ftp

Expected: ftp container on port 21

--- Step 2: Test FTP port is open ---
nc -zv localhost 21

Expected: Connection to localhost (127.0.0.1) 21 port [tcp/ftp] succeeded!

--- Step 3: Check FTP user exists ---
docker exec ftp id ftpuser

Expected: uid=1000(ftpuser) gid=1000(ftpuser) groups=1000(ftpuser),33(www-data)

--- Step 4: Check FTP user has access to WordPress ---
docker exec ftp ls -la /var/www/wordpress | head -10

Expected: List of WordPress files (wp-admin, wp-content, etc.)

--- Step 5: Test FTP Upload (FileZilla Method) ---

A. Install FileZilla (if not installed):
   sudo apt-get install filezilla

B. Open FileZilla

C. Connect:
   Host:     localhost
   Port:     21
   Username: ftpuser
   Password: (get from: cat secrets/ftp_password.txt)
   
   Click "Quickconnect"

D. Navigate to: /wp-content/uploads/

E. Create test file on your computer:
   echo "FTP Test - $(date)" > ~/ftp_test.txt

F. In FileZilla:
   - Left panel: Navigate to your home folder
   - Find ftp_test.txt
   - Drag it to right panel (uploads folder)

--- Step 6: Verify Upload Worked ---

# Check file exists in WordPress container
docker exec wordpress ls -la /var/www/wordpress/wp-content/uploads/ftp_test.txt

# Check file content
docker exec wordpress cat /var/www/wordpress/wp-content/uploads/ftp_test.txt

# Check file on host machine
ls -la /home/winniehhy/data/wordpress/wp-content/uploads/ftp_test.txt
cat /home/winniehhy/data/wordpress/wp-content/uploads/ftp_test.txt

# Access via web browser
curl -k https://hheng.42.fr/wp-content/uploads/ftp_test.txt

Expected: All commands show the same file!

--- Step 7: Test FTP Download ---

In FileZilla:
- Navigate to /wp-config.php
- Right-click ‚Üí Download
- Check it downloaded to your computer

--- Cleanup ---
docker exec wordpress rm /var/www/wordpress/wp-content/uploads/ftp_test.txt


================================================================================
4. PORTAINER (DOCKER MANAGER) TESTING üìπ
================================================================================

Purpose: Visual interface to manage all Docker containers

--- Step 1: Check Portainer is running ---
docker ps | grep portainer

Expected: portainer on port 9000

--- Step 2: Test Portainer web access ---
curl -s http://localhost:9000 | grep -i portainer

Expected: HTML with "Portainer" text

--- Step 3: Open in Browser ---
Open: http://localhost:9000

--- Step 4: First Time Setup (only once) ---
If first time:
1. Create admin password (remember it!)
2. Username: admin
3. Password: (create a strong one)
4. Choose: "Docker" (local)
5. Click "Connect"

--- Step 5: View Dashboard ---
You should see:
  - Containers: 8 running
  - Images: List of all your images
  - Volumes: wordpress_data, mariadb_data, portainer_data
  - Networks: inception

--- Step 6: Inspect Containers ---
Click "Containers"

You should see all running:
  - nginx
  - wordpress
  - mariadb
  - redis
  - ftp
  - adminer
  - website
  - portainer

--- Step 7: View Container Details ---
Click on "wordpress" container
  - See logs
  - See stats (CPU, RAM usage)
  - See environment variables
  - Can restart/stop (DON'T do this now!)

--- Step 8: View Networks ---
Click "Networks"
Click on "inception"

Expected: See all 8 containers connected

--- Step 9: View Volumes ---
Click "Volumes"

Expected: See:
  - mariadb_data
  - wordpress_data
  - portainer_data


================================================================================
5. STATIC WEBSITE TESTING üåê
================================================================================

Purpose: Simple static HTML website (non-PHP requirement for bonus)

--- Step 1: Check website container is running ---
docker ps | grep website

Expected: website container on port 8081

--- Step 2: Test website is accessible ---
curl -s http://localhost:8081 | head -20

Expected: HTML output

--- Step 3: Open in Browser ---
Open: http://localhost:8081

Expected: Your static HTML page loads

--- Step 4: Verify It's NOT PHP ---
docker exec website cat /var/www/html/index.html | head -10

Expected: Pure HTML, NO <?php tags

--- Step 5: Check it's separate from WordPress ---
This should NOT affect WordPress at all.
WordPress is at: https://hheng.42.fr
Static site is at: http://localhost:8081

They are completely independent!


================================================================================
COMPLETE AUTOMATED TEST SCRIPT
================================================================================

Create this file: test_all_bonus.sh

#!/bin/bash
echo "================================================"
echo "    TESTING ALL BONUS SERVICES"
echo "================================================"

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

# Test Redis
echo -e "\n--- Redis Cache ---"
if docker exec redis redis-cli ping 2>/dev/null | grep -q PONG; then
    echo -e "${GREEN}‚úì${NC} Redis is responding"
    KEYS=$(docker exec redis redis-cli DBSIZE 2>/dev/null)
    echo "  Cache size: $KEYS"
else
    echo -e "${RED}‚úó${NC} Redis is NOT responding"
fi

# Test Adminer
echo -e "\n--- Adminer (Database Manager) ---"
if curl -s http://localhost:8080 | grep -q "Adminer"; then
    echo -e "${GREEN}‚úì${NC} Adminer is accessible at http://localhost:8080"
else
    echo -e "${RED}‚úó${NC} Adminer is NOT accessible"
fi

# Test FTP
echo -e "\n--- FTP Server ---"
if nc -zv localhost 21 2>&1 | grep -q succeeded; then
    echo -e "${GREEN}‚úì${NC} FTP port 21 is open"
    if docker exec ftp id ftpuser >/dev/null 2>&1; then
        echo -e "${GREEN}‚úì${NC} FTP user exists"
    fi
else
    echo -e "${RED}‚úó${NC} FTP port is NOT accessible"
fi

# Test Portainer
echo -e "\n--- Portainer (Docker Manager) ---"
if curl -s http://localhost:9000 | grep -q "Portainer"; then
    echo -e "${GREEN}‚úì${NC} Portainer is accessible at http://localhost:9000"
else
    echo -e "${RED}‚úó${NC} Portainer is NOT accessible"
fi

# Test Static Website
echo -e "\n--- Static Website ---"
if curl -s http://localhost:8081 | grep -q "html"; then
    echo -e "${GREEN}‚úì${NC} Static website is accessible at http://localhost:8081"
else
    echo -e "${RED}‚úó${NC} Static website is NOT accessible"
fi

echo -e "\n================================================"
echo "    TEST COMPLETE"
echo "================================================"

--- Run the script ---
chmod +x test_all_bonus.sh
./test_all_bonus.sh


================================================================================
FULL INTEGRATION TEST
================================================================================

This tests that everything works together:

--- Step 1: Generate WordPress Traffic ---
curl -k https://hheng.42.fr

--- Step 2: Check Redis Cached It ---
docker exec redis redis-cli DBSIZE

Expected: Number > 0

--- Step 3: View Database via Adminer ---
Open http://localhost:8080
Login and view wp_posts table

--- Step 4: Upload File via FTP ---
# Create test file
echo "Integration test" > /tmp/integration.txt

# Upload via FileZilla to /wp-content/uploads/

# Verify it's accessible
curl -k https://hheng.42.fr/wp-content/uploads/integration.txt

--- Step 5: Monitor Everything in Portainer ---
Open http://localhost:9000
View all containers are running and healthy

--- Step 6: Visit Static Website ---
Open http://localhost:8081
Verify it loads independently


================================================================================
TROUBLESHOOTING
================================================================================

Problem: Redis DBSIZE returns 0
Solution: WordPress needs php-redis extension and Redis Object Cache plugin
Check: docker exec wordpress php -m | grep redis

Problem: Adminer can't connect to database
Solution: Check MariaDB is running and credentials are correct
Check: docker ps | grep mariadb

Problem: FTP "Could not create file"
Solution: Permission issue
Fix: docker exec ftp chmod -R 775 /var/www/wordpress/wp-content/uploads/

Problem: Portainer asks for password but you forgot it
Solution: Remove portainer volume and restart
Commands:
  docker compose -f srcs/docker-compose.yaml down
  docker volume rm srcs_portainer_data
  docker compose -f srcs/docker-compose.yaml up -d portainer

Problem: Static website not loading
Solution: Check nginx is running in website container
Check: docker exec website ps aux | grep nginx


================================================================================
EVALUATION CHECKLIST
================================================================================

For evaluation, you must demonstrate:

[‚úì] Redis
  - Container running
  - Can connect (redis-cli ping)
  - Caches data (DBSIZE > 0)
  - Speeds up WordPress

[‚úì] Adminer  
  - Accessible at localhost:8080
  - Can login to database
  - Can view/edit tables

[‚úì] FTP
  - Port 21 accessible
  - Can connect with FileZilla
  - Can upload files
  - Files appear in WordPress

[‚úì] Portainer
  - Accessible at localhost:9000
  - Shows all containers
  - Can view logs/stats

[‚úì] Static Website
  - Accessible at localhost:8081
  - Pure HTML (no PHP)
  - Independent from WordPress


================================================================================
QUICK REFERENCE - ALL ACCESS URLS
================================================================================

WordPress:       https://hheng.42.fr
WordPress Admin: https://hheng.42.fr/wp-admin
Adminer:         http://localhost:8080
Portainer:       http://localhost:9000
Static Website:  http://localhost:8081
FTP:             ftp://localhost:21 (use FileZilla)

Redis:           (internal only, port 6379)
MariaDB:         (internal only, port 3306)


================================================================================
END OF TESTING GUIDE
================================================================================
